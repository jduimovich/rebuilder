<!DOCTYPE html>
<html lang="en">
<title>Rebuilder</title>   

<body>

  <h1> rebuilder </h1> 
  <div id='rebuilder'>
    <button onclick="rebuild()"> Rebuild All </button>
  </div>

  <h1> Authorize </h1>
  <form action="/authorize" method="GET">
    <p>Enter the contents of <pre>oc whoami --show-token</pre>:</p>
    <input type="text">
</form>

<div id='poll'>
  <button onclick="poll()"> Start Polling </button>
</div>
  
  <script>  
    function getJSONAndUpdate(url, id, updateCB, errorCB) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () { 
        if (this.readyState == 4) {  
          if (this.status == 200 || this.status == 304) {
            try { 
              if (this.responseText == "") {  
                updateCB("", id);
              } else {  
                updateCB(JSON.parse(this.responseText), id);
              } 
            } catch (err) {
              if (errorCB) errorCB(id);
            }
          } else {
            if (errorCB) errorCB(id);
          }
        }
      };
      xhttp.open("GET", url, true);
      xhttp.setRequestHeader('Content-type', 'application/json');
      xhttp.setRequestHeader('Accept', 'application/json');
      xhttp.send();
    }
    function errorCB(msg) {
      console.log("Error Occurred: ", msg)
    } 
    function rebuild() {
      function redirect(response,id) { 
        console.log ("rebuild", JSON.stringify(response))  
      }
      getJSONAndUpdate("rebuild", "rebuild", redirect, errorCB);
    } 
    function poll() {
      function redirect(response,id) { 
        console.log ("poll", JSON.stringify(response))  
      }
      getJSONAndUpdate("poll", "poll", redirect, errorCB);
    } 
  </script>

</body>

</html>
